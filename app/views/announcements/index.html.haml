%section#announcements
.page-header
  %h1 
    Announcements
    %small Offers and requests
.navbar
  .navbar-inner
    .container
      %ul.nav
        %li
          %a{href: "?", :"data-remote" => true, :"data-replace" => '#announcement-list'}
            %i.icon-list.icon-white
            All
        %li.dropdown
          %a.dropdown-toggle{href: '#', :"data-toggle" => "dropdown"}
            %i.icon-refresh.icon-white
            Type
            %b.caret
          %ul.dropdown-menu
            %li
              %a{href: "?type=offer", :"data-remote" => true, :"data-replace" => '#announcement-list'}
                %i.icon-arrow-right
                Offers
            %li
              %a{href: "?type=request", :"data-remote" => true, :"data-replace" => '#announcement-list'}
                %i.icon-arrow-left
                Requests
        - if can? :participate, Conversation
          %li.dropdown
            %a.dropdown-toggle{href: '#', :"data-toggle" => "dropdown"}
              %i.icon-user.icon-white
              Status
              %b.caret
            %ul.dropdown-menu
              %li
                %a{href: "?mine=1", :"data-remote" => true, :"data-replace" => '#announcement-list'}
                  %i.icon-user
                  Mine
              %li
                %a{href: "?with_me=1", :"data-remote" => true, :"data-replace" => '#announcement-list'}
                  %i.icon-align-left
                  Conversating

        
        %li.dropdown
          %a.dropdown-toggle{href: '#', :"data-toggle" => "dropdown"}
            %i.icon-tags.icon-white
            Tags
            %b.caret
          %ul.dropdown-menu
            - Announcement.tags_with_weight.sort.each do |(tag, wt)|
              %li
                %a{href: "?tag=#{tag}", :"data-remote" => true, :"data-replace" => '#announcement-list'}
                  %i.icon-tag
                  = "#{tag} (#{wt.to_i})"
      %form.navbar-search{action: "#"}
        %input.search-query{type: "text", placeholder: "Search", name: "q"}
      - if can? :create, Announcement
        %a.btn.btn-success.pull-right{href: new_announcement_path}
          %i.icon-plus
          New Announcement
      
.row
  .span12
    %table.table.table-striped
      %thead
        %tr
          %th
            %i.icon-refresh
            Type
          %th 
            %i.icon-tags 
            Tags
          %th Title
          - if can? :see, :author
            %th
              %i.icon-user
              Author
          %th
            %i.icon-calendar
            Created
      %tbody#announcement-list
        = render collection: @announcements, partial: "announcements/announcement_row"
